<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/static/redoc/favicon.png" />
    <link rel="stylesheet" href="/static/home/bulma.min.css" />
    <title>Embeddings</title>
  </head>
  <body>
    <div class="container is-fluid">
      <section class="hero is-warning">
        <div class="hero-body">
          <h1 class="title">向量化 Embeddings</h1>
          <h2 class="subtitle">
            将输入的文本列表转换为对应的嵌入向量（embeddings），支持多语言和长文本。
          </h2>
        </div>
      </section>
      <div class="columns is-desktop" style="margin-top: 20px">
        <div class="column">
          <div class="field">
            <label class="label">模型地址：</label>
            <div class="control">
              <input
                id="address"
                class="input is-warning"
                type="text"
                placeholder="http://localhost:8000/v1/embeddings"
                autocomplete="off"
              />
            </div>
          </div>
          <div class="notification is-warning" id="tip-address">
            请求地址不能为空
          </div>

          <div class="field">
            <label class="label">模型秘钥：</label>
            <div class="control">
              <input
                id="key"
                class="input is-warning"
                type="text"
                placeholder="sk-123456"
              />
            </div>
          </div>

          <div class="field">
            <label class="label">模型名称：</label>
            <div class="control">
              <input
                id="model-name"
                class="input is-warning"
                type="text"
                placeholder="bge-m3"
              />
            </div>
            <p class="help is-warning">
              常见向量模型：bge-m3、bge-base-zh-v1.5、qwen3-embedding
            </p>
          </div>
          <div class="notification is-warning" id="tip-model-name">
            模型名称不能为空
          </div>
          <div class="field">
            <label class="label">向量化文本列表：</label>
          </div>

          <div class="field has-addons">
            <p class="control">
              <a class="button is-static"> 1. </a>
            </p>
            <div class="control is-expanded">
              <input
                id="input-1"
                class="input is-warning"
                type="text"
                placeholder="Apple 是一家伟大的公司，他们的主要产品有 iPhone、iPad 和 Mac。"
              />
            </div>
          </div>

          <div class="field has-addons">
            <p class="control">
              <a class="button is-static"> 2. </a>
            </p>
            <div class="control is-expanded">
              <input
                id="input-2"
                class="input is-warning"
                type="text"
                placeholder="Microsoft 是一家伟大的公司，他们的主要产品有 Windows、Xbox 和 Surface。"
              />
            </div>
          </div>

          <div class="field has-addons">
            <p class="control">
              <a class="button is-static"> 3. </a>
            </p>
            <div class="control is-expanded">
              <input
                id="input-3"
                class="input is-warning"
                type="text"
                placeholder="OpenAI 是一家伟大的公司，他们的主要产品有 GPT-3、GPT-4o、GPT-5。"
              />
            </div>
          </div>
          <div class="notification is-warning" id="tip-input">
            至少有一行向量化文本
          </div>
          <div class="control is-expanded">
            <button id="send" class="button is-warning is-fullwidth">
              发起请求
            </button>
          </div>
        </div>
        <div class="column">
          <div class="field">
            <label class="label">模型维度：</label>
            <div class="control">
              <input
                id="model-dimensions"
                class="input is-warning"
                type="number"
                placeholder="0"
                readonly
              />
            </div>
          </div>

          <div class="field">
            <label class="label">返回结果：</label>
            <textarea
              id="result"
              class="textarea is-warning"
              rows="20"
              placeholder="输出结果"
            ></textarea>
          </div>
        </div>
      </div>
    </div>

    <script>
      const eleAddress = document.querySelector("#address");
      const eleKey = document.querySelector("#key");
      const eleModelName = document.querySelector("#model-name");
      const eleInput1 = document.querySelector("#input-1");
      const eleInput2 = document.querySelector("#input-2");
      const eleInput3 = document.querySelector("#input-3");
      const eleSend = document.querySelector("#send");
      const eleResult = document.querySelector("#result");
      const eleModelDimensions = document.querySelector("#model-dimensions");
      const eleTipAddress = document.querySelector("#tip-address");
      const eleTipModelName = document.querySelector("#tip-model-name");
      const eleTipInput = document.querySelector("#tip-input");

      eleAddress.value = `${location.origin}/v1/embeddings`;
      eleModelName.value = "bge-m3";
      eleInput1.value =
        "Apple 是一家伟大的公司，他们的主要产品有 iPhone、iPad 和 Mac。";
      eleInput2.value =
        "Microsoft 是一家伟大的公司，他们的主要产品有 Windows、Xbox 和 Surface。";
      eleInput3.value =
        "OpenAI 是一家伟大的公司，他们的主要产品有 GPT-3、GPT-4o、GPT-5。";

      if (
        "embeddings_address" in localStorage &&
        localStorage.getItem("embeddings_address").length > 0
      ) {
        eleAddress.value = localStorage.getItem("embeddings_address");
      }
      if (
        "embeddings_key" in localStorage &&
        localStorage.getItem("embeddings_key").length > 0
      ) {
        eleKey.value = localStorage.getItem("embeddings_key");
      }

      if (
        "embeddings_modelName" in localStorage &&
        localStorage.getItem("embeddings_modelName").length > 0
      ) {
        eleModelName.value = localStorage.getItem("embeddings_modelName");
      }

      if (
        "embeddings_input1" in localStorage &&
        localStorage.getItem("embeddings_input1").length > 0
      ) {
        eleInput1.value = localStorage.getItem("embeddings_input1");
      }

      if (
        "embeddings_input2" in localStorage &&
        localStorage.getItem("embeddings_input2").length > 0
      ) {
        eleInput2.value = localStorage.getItem("embeddings_input2");
      }

      if (
        "embeddings_input3" in localStorage &&
        localStorage.getItem("embeddings_input3").length > 0
      ) {
        eleInput3.value = localStorage.getItem("embeddings_input3");
      }

      if (
        "embeddings_modelDimensions" in localStorage &&
        localStorage.getItem("embeddings_modelDimensions").length > 0
      ) {
        eleModelDimensions.value = localStorage.getItem(
          "embeddings_modelDimensions"
        );
      }

      if (
        "embeddings_result" in localStorage &&
        localStorage.getItem("embeddings_result").length > 0
      ) {
        eleResult.value = localStorage.getItem("embeddings_result");
      }

      eleTipAddress.style.display = "none";
      eleTipModelName.style.display = "none";
      eleTipInput.style.display = "none";

      eleSend.addEventListener("click", () => {
        if (eleAddress.value.length === 0) {
          eleTipAddress.style.display = "block";
          return;
        }

        if (eleModelName.value.length === 0) {
          eleTipModelName.style.display = "block";
          return;
        }

        if (
          eleInput1.value.length === 0 &&
          eleInput2.value.length === 0 &&
          eleInput3.value.length === 0
        ) {
          eleTipInput.style.display = "block";
          return;
        }

        const input = [];
        if (eleInput1.value.length > 0) {
          input.push(eleInput1.value);
        }
        if (eleInput2.value.length > 0) {
          input.push(eleInput2.value);
        }
        if (eleInput3.value.length > 0) {
          input.push(eleInput3.value);
        }

        eleTipAddress.style.display = "none";
        eleTipModelName.style.display = "none";
        eleTipInput.style.display = "none";

        localStorage.setItem("embeddings_address", eleAddress.value);
        localStorage.setItem("embeddings_key", eleKey.value);
        localStorage.setItem("embeddings_modelName", eleModelName.value);
        localStorage.setItem("embeddings_input1", eleInput1.value);
        localStorage.setItem("embeddings_input2", eleInput2.value);
        localStorage.setItem("embeddings_input3", eleInput3.value);

        fetch(eleAddress.value, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${eleKey.value}`,
          },
          body: JSON.stringify({
            model: eleModelName.value,
            input: input,
          }),
        })
          .then((response) => response.json())
          .then((res_data) => {
            if (res_data.data == undefined) {
              eleResult.value = JSON.stringify(res_data, null, 2);
              return;
            }

            let data = res_data.data;
            eleModelDimensions.value = data[0].embedding.length;
            data.forEach((e) => {
              e.embedding = e.embedding.slice(0, 5);
              e.embedding.push("...");
            });
            let json_text = JSON.stringify(res_data, null, 2);
            json_text = json_text.replace(/\"...\"/g, "...");
            eleResult.value = json_text;

            localStorage.setItem(
              "embeddings_modelDimensions",
              eleModelDimensions.value
            );
            localStorage.setItem("embeddings_result", eleResult.value);
          })
          .catch((error) => console.error("Error:", error));
      });
    </script>
  </body>
</html>
