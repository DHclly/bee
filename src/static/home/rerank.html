<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/static/redoc/favicon.png" />
    <link rel="stylesheet" href="/static/home/bulma.min.css" />
    <title>Embeddings</title>
  </head>
  <body>
    <div class="container is-fluid">
      <section class="hero is-warning">
        <div class="hero-body">
          <h1 class="title">向量化 Embeddings</h1>
          <h2 class="subtitle">
            将输入的文本列表转换为对应的嵌入向量（embeddings），支持多语言和长文本。
          </h2>
        </div>
      </section>
      <div class="columns is-desktop" style="margin-top: 20px">
        <div class="column">
          <div class="field">
            <label class="label">模型地址：</label>
            <div class="control">
              <input
                id="address"
                class="input is-warning"
                type="text"
                placeholder="http://localhost:8000/v1/embeddings"
              />
            </div>
          </div>
          <div class="notification is-warning" id="tip-address">
            请求地址不能为空
          </div>

          <div class="field">
            <label class="label">模型秘钥：</label>
            <div class="control">
              <input
                id="key"
                class="input is-warning"
                type="text"
                placeholder="sk-123456"
              />
            </div>
          </div>

          <div class="field">
            <label class="label">模型名称：</label>
            <div class="control">
              <input
                id="model-name"
                class="input is-warning"
                type="email"
                placeholder="bge-m3"
              />
            </div>
            <p class="help is-warning">
              常见向量模型：bge-m3、bge-base-zh-v1.5、qwen3-embedding
            </p>
          </div>
          <div class="notification is-warning" id="tip-model-name">
            模型名称不能为空
          </div>
          <div class="field">
            <label class="label">向量化文本列表：</label>
          </div>

          <div class="field has-addons">
            <p class="control">
              <a class="button is-static"> 1. </a>
            </p>
            <div class="control is-expanded">
              <input
                id="input-1"
                class="input is-warning"
                type="text"
                placeholder="Apple 是一家伟大的公司，他们的主要产品有 iPhone、iPad 和 Mac。"
              />
            </div>
          </div>

          <div class="field has-addons">
            <p class="control">
              <a class="button is-static"> 2. </a>
            </p>
            <div class="control is-expanded">
              <input
                id="input-2"
                class="input is-warning"
                type="text"
                placeholder="Microsoft 是一家伟大的公司，他们的主要产品有 Windows、Xbox 和 Surface。"
              />
            </div>
          </div>

          <div class="field has-addons">
            <p class="control">
              <a class="button is-static"> 3. </a>
            </p>
            <div class="control is-expanded">
              <input
                id="input-3"
                class="input is-warning"
                type="text"
                placeholder="OpenAI 是一家伟大的公司，他们的主要产品有 GPT-3、GPT-4o、GPT-5。"
              />
            </div>
          </div>
          <div class="notification is-warning" id="tip-input">
            至少有一行向量化文本不能为空
          </div>
          <div class="control is-expanded">
            <button id="send" class="button is-warning is-fullwidth">
              发起请求
            </button>
          </div>
        </div>
        <div class="column">
          <div class="field">
            <label class="label">模型维度：</label>
            <div class="control">
              <input
                id="model-dimensions"
                class="input is-warning"
                type="number"
                placeholder="0"
                disabled
              />
            </div>
          </div>

          <div class="field">
            <label class="label">返回结果：</label>
            <textarea
              id="result"
              class="textarea is-warning"
              rows="20"
              placeholder="输出结果"
            ></textarea>
          </div>
        </div>
      </div>
    </div>

    <script>
      const address = document.querySelector("#address");
      const key = document.querySelector("#key");
      const modelName = document.querySelector("#model-name");
      const input1 = document.querySelector("#input-1");
      const input2 = document.querySelector("#input-2");
      const input3 = document.querySelector("#input-3");
      const send = document.querySelector("#send");
      const result = document.querySelector("#result");
      const modelDimensions = document.querySelector("#model-dimensions");
      const tipAddress = document.querySelector("#tip-address");
      const tipModelName = document.querySelector("#tip-model-name");
      const tipInput = document.querySelector("#tip-input");

      address.value = `${location.origin}/v1/embeddings`;
      modelName.value = "bge-m3";
      input1.value =
        "Apple 是一家伟大的公司，他们的主要产品有 iPhone、iPad 和 Mac。";
      input2.value =
        "Microsoft 是一家伟大的公司，他们的主要产品有 Windows、Xbox 和 Surface。";
      input3.value =
        "OpenAI 是一家伟大的公司，他们的主要产品有 GPT-3、GPT-4o、GPT-5。";

      if ("embeddings_address" in localStorage && localStorage.getItem("embeddings_address").length > 0) {
        address.value = localStorage.getItem("embeddings_address");
      }
      if ("embeddings_key" in localStorage && localStorage.getItem("embeddings_key").length > 0) {
        key.value = localStorage.getItem("embeddings_key");
      }

      if ("embeddings_modelName" in localStorage && localStorage.getItem("embeddings_modelName").length > 0) {
        modelName.value = localStorage.getItem("embeddings_modelName");
      }

      if ("embeddings_input1" in localStorage && localStorage.getItem("embeddings_input1").length > 0) {
        input1.value = localStorage.getItem("embeddings_input1");
      }

      if ("embeddings_input2" in localStorage && localStorage.getItem("embeddings_input2").length > 0) {
        input2.value = localStorage.getItem("embeddings_input2");
      }

      if ("embeddings_input3" in localStorage && localStorage.getItem("embeddings_input3").length > 0) {
        input3.value = localStorage.getItem("embeddings_input3");
      }

      tipAddress.style.display = "none";
      tipModelName.style.display = "none";
      tipInput.style.display = "none";

      send.addEventListener("click", () => {
        if (address.value.length === 0) {
          tipAddress.style.display = "block";
          return;
        }

        if (modelName.value.length === 0) {
          tipModelName.style.display = "block";
          return;
        }

        if (
          input1.value.length === 0 &&
          input2.value.length === 0 &&
          input3.value.length === 0
        ) {
          tipInput.style.display = "block";
          return;
        }

        const input = [];
        if (input1.value.length > 0) {
          input.push(input1.value);
        }
        if (input2.value.length > 0) {
          input.push(input2.value);
        }
        if (input3.value.length > 0) {
          input.push(input3.value);
        }

        tipAddress.style.display = "none";
        tipModelName.style.display = "none";
        tipInput.style.display = "none";

        localStorage.setItem("embeddings_address", address.value);
        localStorage.setItem("embeddings_key", key.value);
        localStorage.setItem("embeddings_modelName", modelName.value);
        localStorage.setItem("embeddings_input1", input1.value);
        localStorage.setItem("embeddings_input2", input2.value);
        localStorage.setItem("embeddings_input3", input3.value);

        fetch(address.value, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${key.value}`,
          },
          body: JSON.stringify({
            model: modelName.value,
            input: input,
          }),
        })
          .then((response) => response.json())
          .then((res_data) => {
            let data = res_data.data;
            modelDimensions.value = data[0].embedding.length;
            data.forEach((e) => {
              e.embedding = e.embedding.slice(0, 5);
              e.embedding.push("...");
            });
            let json_text = JSON.stringify(res_data, null, 2);
            json_text = json_text.replace(/\"...\"/g, "...");
            result.value = json_text;
          })
          .catch((error) => console.error("Error:", error));
      });
    </script>
  </body>
</html>
